<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GRC Compliance Dashboard</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
                'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',
                sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        .bg-slate-950 {
            background-color: rgb(2 6 23);
        }
        
        .bg-slate-900 {
            background-color: rgb(15 23 42);
        }
        
        .bg-slate-800 {
            background-color: rgb(30 41 59);
        }
        
        .border-slate-700 {
            border-color: rgb(51 65 85);
        }
        
        .text-slate-200 {
            color: rgb(226 232 240);
        }
        
        .text-slate-400 {
            color: rgb(148 163 184);
        }
        
        .text-slate-500 {
            color: rgb(100 116 139);
        }
        
        .animate-spin {
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;
        const { createRoot } = ReactDOM;

        // API Service
        const apiService = {
            baseURL: 'http://localhost:8000',
            
            async fetchDashboard() {
                const response = await fetch(`${this.baseURL}/api/dashboard`);
                if (!response.ok) throw new Error('Failed to fetch dashboard data');
                return response.json();
            },
            
            async fetchAiInsights() {
                const response = await fetch(`${this.baseURL}/api/ai-insights`);
                if (!response.ok) throw new Error('Failed to fetch AI insights');
                return response.json();
            },
            
            async fetchChecks(filters = {}) {
                const params = new URLSearchParams();
                Object.entries(filters).forEach(([key, value]) => {
                    if (value) params.append(key, value);
                });
                
                const response = await fetch(`${this.baseURL}/api/checks?${params}`);
                if (!response.ok) throw new Error('Failed to fetch checks');
                return response.json();
            },
            
            async fetchStats() {
                const response = await fetch(`${this.baseURL}/api/stats`);
                if (!response.ok) throw new Error('Failed to fetch stats');
                return response.json();
            }
        };

        // Components
        const Card = ({ children, className = "" }) => (
            <div className={`bg-slate-800 border border-slate-700 rounded-lg ${className}`}>
                {children}
            </div>
        );

        const CardHeader = ({ children }) => (
            <div className="p-6 pb-2">
                {children}
            </div>
        );

        const CardTitle = ({ children, className = "" }) => (
            <h3 className={`text-lg font-semibold text-white ${className}`}>
                {children}
            </h3>
        );

        const CardDescription = ({ children }) => (
            <p className="text-sm text-slate-400 mt-1">
                {children}
            </p>
        );

        const CardContent = ({ children }) => (
            <div className="p-6 pt-0">
                {children}
            </div>
        );

        const Badge = ({ children, className = "" }) => (
            <span className={`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${className}`}>
                {children}
            </span>
        );

        const Button = ({ children, onClick, className = "", variant = "default" }) => {
            const baseClasses = "inline-flex items-center px-4 py-2 rounded-md text-sm font-medium transition-colors";
            const variantClasses = variant === "outline" 
                ? "border border-slate-600 text-slate-200 hover:bg-slate-700"
                : "bg-blue-600 text-white hover:bg-blue-700";
            
            return (
                <button 
                    onClick={onClick}
                    className={`${baseClasses} ${variantClasses} ${className}`}
                >
                    {children}
                </button>
            );
        };

        // Simple icon components
        const Shield = ({ className = "" }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" />
            </svg>
        );

        const TrendingUp = ({ className = "" }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" />
            </svg>
        );

        const AlertTriangle = ({ className = "" }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z" />
            </svg>
        );

        const TrendingDown = ({ className = "" }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 17h8m0 0V9m0 8l-8-8-4 4-6-6" />
            </svg>
        );

        const RefreshCw = ({ className = "" }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
            </svg>
        );

        const CheckCircle = ({ className = "" }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
        );

        const XCircle = ({ className = "" }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
        );

        // Main Dashboard Component
        const ComplianceDashboard = () => {
            const [dashboardData, setDashboardData] = useState(null);
            const [aiInsights, setAiInsights] = useState(null);
            const [loading, setLoading] = useState(true);
            const [error, setError] = useState(null);

            const fetchData = async () => {
                try {
                    setLoading(true);
                    setError(null);
                    
                    const [dashboard, insights] = await Promise.all([
                        apiService.fetchDashboard(),
                        apiService.fetchAiInsights()
                    ]);
                    
                    setDashboardData(dashboard);
                    setAiInsights(insights);
                } catch (err) {
                    setError(err.message);
                } finally {
                    setLoading(false);
                }
            };

            useEffect(() => {
                fetchData();
            }, []);

            const getSeverityColor = (severity) => {
                switch (severity?.toLowerCase()) {
                    case 'critical': return 'bg-red-500 text-white';
                    case 'high': return 'bg-orange-500 text-white';
                    case 'medium': return 'bg-yellow-500 text-black';
                    case 'low': return 'bg-blue-500 text-white';
                    default: return 'bg-gray-500 text-white';
                }
            };

            const getStatusIcon = (status) => {
                switch (status?.toLowerCase()) {
                    case 'passing': return <CheckCircle className="h-4 w-4 text-green-500" />;
                    case 'failing': return <XCircle className="h-4 w-4 text-red-500" />;
                    case 'warning': return <AlertTriangle className="h-4 w-4 text-yellow-500" />;
                    default: return <AlertTriangle className="h-4 w-4 text-gray-500" />;
                }
            };

            if (loading) {
                return (
                    <div className="min-h-screen bg-slate-950 flex items-center justify-center">
                        <div className="flex items-center space-x-2">
                            <RefreshCw className="h-8 w-8 animate-spin text-purple-500" />
                            <span className="text-white">Loading compliance data...</span>
                        </div>
                    </div>
                );
            }

            if (error) {
                return (
                    <div className="min-h-screen bg-slate-950 flex flex-col items-center justify-center">
                        <AlertTriangle className="h-12 w-12 text-red-500 mb-4" />
                        <p className="text-red-400 mb-4">Error: {error}</p>
                        <Button onClick={fetchData} variant="outline">
                            <RefreshCw className="h-4 w-4 mr-2" />
                            Retry
                        </Button>
                    </div>
                );
            }

            if (!dashboardData || !aiInsights) {
                return (
                    <div className="min-h-screen bg-slate-950 flex items-center justify-center">
                        <p className="text-white">No data available</p>
                    </div>
                );
            }

            const compliancePercentage = Math.round((dashboardData.compliant / dashboardData.total_checks) * 100);

            return (
                <div className="min-h-screen bg-slate-950 p-6">
                    <div className="max-w-7xl mx-auto space-y-6">
                        {/* Header */}
                        <div className="flex items-center justify-between">
                            <div>
                                <h1 className="text-3xl font-bold text-white">GRC Compliance Dashboard</h1>
                                <p className="text-slate-400 mt-1">Real-time compliance monitoring and AI-powered insights</p>
                            </div>
                            <Button onClick={fetchData} variant="outline">
                                <RefreshCw className="h-4 w-4 mr-2" />
                                Refresh
                            </Button>
                        </div>

                        {/* Summary Cards */}
                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                            <Card>
                                <CardHeader>
                                    <div className="flex items-center justify-between">
                                        <CardTitle className="text-sm font-medium text-slate-200">Total Checks</CardTitle>
                                        <Shield className="h-4 w-4 text-slate-400" />
                                    </div>
                                </CardHeader>
                                <CardContent>
                                    <div className="text-2xl font-bold text-white">{dashboardData.total_checks}</div>
                                    <p className="text-xs text-slate-400">Across all frameworks</p>
                                </CardContent>
                            </Card>

                            <Card>
                                <CardHeader>
                                    <div className="flex items-center justify-between">
                                        <CardTitle className="text-sm font-medium text-slate-200">Compliance Rate</CardTitle>
                                        <TrendingUp className="h-4 w-4 text-green-400" />
                                    </div>
                                </CardHeader>
                                <CardContent>
                                    <div className="text-2xl font-bold text-white">{compliancePercentage}%</div>
                                    <p className="text-xs text-slate-400">{dashboardData.compliant} of {dashboardData.total_checks} passing</p>
                                </CardContent>
                            </Card>

                            <Card>
                                <CardHeader>
                                    <div className="flex items-center justify-between">
                                        <CardTitle className="text-sm font-medium text-slate-200">Critical Issues</CardTitle>
                                        <AlertTriangle className="h-4 w-4 text-red-400" />
                                    </div>
                                </CardHeader>
                                <CardContent>
                                    <div className="text-2xl font-bold text-white">{dashboardData.critical_count}</div>
                                    <p className="text-xs text-slate-400">Require immediate attention</p>
                                </CardContent>
                            </Card>

                            <Card>
                                <CardHeader>
                                    <div className="flex items-center justify-between">
                                        <CardTitle className="text-sm font-medium text-slate-200">Non-Compliant</CardTitle>
                                        <TrendingDown className="h-4 w-4 text-red-400" />
                                    </div>
                                </CardHeader>
                                <CardContent>
                                    <div className="text-2xl font-bold text-white">{dashboardData.non_compliant}</div>
                                    <p className="text-xs text-slate-400">Failed checks</p>
                                </CardContent>
                            </Card>
                        </div>

                        {/* Framework Scores */}
                        <Card>
                            <CardHeader>
                                <CardTitle>Framework Scores</CardTitle>
                                <CardDescription>Compliance percentage by framework</CardDescription>
                            </CardHeader>
                            <CardContent>
                                <div className="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-6 gap-4">
                                    {Object.entries(dashboardData.framework_scores).map(([framework, score]) => (
                                        <div key={framework} className="text-center">
                                            <div className="text-2xl font-bold text-white">{score}%</div>
                                            <div className="text-sm text-slate-400">{framework}</div>
                                        </div>
                                    ))}
                                </div>
                            </CardContent>
                        </Card>

                        {/* Recent Violations */}
                        <Card>
                            <CardHeader>
                                <CardTitle>Recent Violations</CardTitle>
                                <CardDescription>Latest compliance issues detected</CardDescription>
                            </CardHeader>
                            <CardContent>
                                <div className="space-y-4">
                                    {dashboardData.recent_violations.slice(0, 5).map((violation) => (
                                        <div key={violation.id} className="flex items-center justify-between p-4 bg-slate-900 rounded-lg">
                                            <div className="flex items-center space-x-4">
                                                {getStatusIcon(violation.status)}
                                                <div>
                                                    <div className="font-medium text-white">{violation.description}</div>
                                                    <div className="text-sm text-slate-400">
                                                        {violation.framework} • {violation.provider} • Risk Score: {violation.risk_score}
                                                    </div>
                                                    <div className="text-xs text-slate-500 mt-1">{violation.ai_summary}</div>
                                                </div>
                                            </div>
                                            <Badge className={getSeverityColor(violation.severity)}>
                                                {violation.severity}
                                            </Badge>
                                        </div>
                                    ))}
                                </div>
                            </CardContent>
                        </Card>

                        {/* AI Insights */}
                        <Card>
                            <CardHeader>
                                <CardTitle>AI Insights & Recommendations</CardTitle>
                                <CardDescription>AI-powered analysis and suggestions</CardDescription>
                            </CardHeader>
                            <CardContent>
                                <div className="space-y-4">
                                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                                        <div className="text-center">
                                            <div className="text-2xl font-bold text-white">{aiInsights.summary.total_non_compliant}</div>
                                            <div className="text-sm text-slate-400">Total Violations</div>
                                        </div>
                                        <div className="text-center">
                                            <div className="text-2xl font-bold text-white">{aiInsights.summary.critical_violations}</div>
                                            <div className="text-sm text-slate-400">Critical Violations</div>
                                        </div>
                                        <div className="text-center">
                                            <div className="text-2xl font-bold text-white">{aiInsights.summary.overall_compliance_percentage}%</div>
                                            <div className="text-sm text-slate-400">Overall Compliance</div>
                                        </div>
                                    </div>
                                    
                                    {aiInsights.recommendations.length > 0 && (
                                        <div className="mt-6">
                                            <h4 className="text-lg font-semibold text-white mb-3">Recommendations</h4>
                                            <div className="space-y-3">
                                                {aiInsights.recommendations.map((rec, index) => (
                                                    <div key={index} className="p-3 bg-slate-900 rounded-lg">
                                                        <div className="flex items-center justify-between mb-2">
                                                            <Badge className={getSeverityColor(rec.priority)}>
                                                                {rec.priority}
                                                            </Badge>
                                                        </div>
                                                        <div className="text-white font-medium">{rec.title}</div>
                                                        <div className="text-sm text-slate-400 mt-1">{rec.description}</div>
                                                        <div className="text-xs text-slate-500 mt-1">{rec.action}</div>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                    )}
                                </div>
                            </CardContent>
                        </Card>
                    </div>
                </div>
            );
        };

        // Render the app
        const root = createRoot(document.getElementById('root'));
        root.render(<ComplianceDashboard />);
    </script>
</body>
</html>

